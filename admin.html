<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ù–æ–≤–æ–≥–æ–¥–Ω–∞—è –ò–≥—Ä–∞ v5.3.5 –ò–°–ü–†–ê–í–õ–ï–ù–û</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è -->
    <script src="firebase-config.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header .version {
            color: #666;
            font-size: 16px;
            background: #f0f0f0;
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
        }

        .access-screen {
            display: block;
            text-align: center;
            padding: 100px 0;
        }

        .access-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 0 auto;
        }

        .access-container h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .access-container input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .access-container input:focus {
            outline: none;
            border-color: #667eea;
        }

        .access-container button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .access-container button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .admin-content {
            display: none;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
        }

        .tab {
            padding: 15px 25px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 16px;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab:hover {
            background: #5a6fd8;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.info {
            background: #17a2b8;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .modal-header h3 {
            color: #667eea;
            margin: 0;
        }

        .close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .close:hover {
            color: #333;
        }

        .task-form {
            display: none;
        }

        .task-form.show {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: calc(50% - 2px);
                margin-bottom: 5px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÑ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ù–æ–≤–æ–≥–æ–¥–Ω–µ–π –ò–≥—Ä—ã</h1>
            <div class="version">v5.3.5 –ò–°–ü–†–ê–í–õ–ï–ù–û</div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –¥–æ—Å—Ç—É–ø–∞ -->
        <div class="access-screen active" id="accessScreen">
            <div class="access-container">
                <h2>üîë –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                <div class="form-group">
                    <input type="password" id="accessCode" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞">
                </div>
                <button onclick="checkAccess()">–í–æ–π—Ç–∏</button>
                <div id="accessError" style="color: red; margin-top: 10px; display: none;"></div>
            </div>
        </div>

        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
        <div class="admin-content" id="adminContent">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('quick-actions')">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</button>
                <button class="tab" onclick="switchTab('game-management')">üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π</button>
                <button class="tab" onclick="switchTab('results')">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                <button class="tab" onclick="switchTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="tab-content active" id="quick-actions">
                <div class="card">
                    <h3>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                    <p>–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–π</p>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateGameLink()">
                            üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∏–≥—Ä—É
                        </button>
                        
                        <button class="btn btn-success" onclick="downloadQRCode()">
                            üì± –°–∫–∞—á–∞—Ç—å QR-–∫–æ–¥
                        </button>
                        
                        <button class="btn btn-warning" onclick="printInstructions()">
                            üñ®Ô∏è –ü–µ—á–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
                        </button>
                        
                        <button class="btn btn-primary" onclick="openGame()">
                            üéØ –û—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä—É
                        </button>
                        
                        <button class="btn btn-info" onclick="showQRModal()">
                            üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3>üîç –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h3>
                    <div id="systemStatus">
                        <button class="btn btn-primary" onclick="checkSystem()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É</button>
                        <div id="systemInfo" style="margin-top: 15px;"></div>
                    </div>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π -->
            <div class="tab-content" id="game-management">
                <div class="card">
                    <h3>üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏</h3>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="showTaskForm('add')">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
                        <button class="btn btn-warning" onclick="showTaskForm('edit')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger" onclick="deleteTask()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        <button class="btn btn-primary" onclick="loadTasks()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è</button>
                    </div>
                    <div class="task-list" id="taskList" style="margin-top: 20px;">
                        <p>–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–∞–¥–∞–Ω–∏—è...</p>
                    </div>
                </div>

                <div class="card">
                    <h3>üíæ GitHub –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>GitHub –í–ª–∞–¥–µ–ª–µ—Ü:</label>
                            <input type="text" id="githubOwner" value="fancifulaction-rgb">
                        </div>
                        <div class="form-group">
                            <label>–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:</label>
                            <input type="text" id="githubRepo" value="christmas_game">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Personal Access Token:</label>
                        <input type="password" id="githubToken" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω">
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="setupGitHubIntegration()">üíæ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é</button>
                        <button class="btn btn-primary" onclick="testGitHubConnection()">üîó –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
                        <button class="btn btn-warning" onclick="autoSaveToGitHub()">üîÑ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ GitHub</button>
                    </div>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div class="tab-content" id="results">
                <div class="card">
                    <h3>üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</h3>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="loadResults()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                        <button class="btn btn-success" onclick="exportResults()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                        <button class="btn btn-danger" onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>–ò–≥—Ä–æ–∫</th>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–ó–∞–¥–∞–Ω–∏—è</th>
                                    <th>–ë–∞–ª–ª—ã</th>
                                    <th>–ü–æ–¥—Å–∫–∞–∑–∫–∏</th>
                                    <th>–†–µ–π—Ç–∏–Ω–≥</th>
                                    <th>–î–∞—Ç–∞</th>
                                </tr>
                            </thead>
                            <tbody id="resultsBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 20px;">
                                        üìä –ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="tab-content" id="settings">
                <div class="card">
                    <h3>üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                    <div class="form-group">
                        <label>–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
                        <input type="password" id="currentPassword" placeholder="–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å">
                        <input type="password" id="newPassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" style="margin-top: 10px;">
                        <input type="password" id="confirmPassword" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="margin-top: 10px;">
                        <button class="btn btn-primary" onclick="changePassword()" style="margin-top: 10px;">
                            üíæ –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskModalTitle">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</h3>
                <button class="close" onclick="closeTaskForm()">&times;</button>
            </div>
            
            <div class="task-form" id="addTaskForm">
                <div class="form-group">
                    <label>–í–æ–ø—Ä–æ—Å:</label>
                    <textarea id="taskQuestion" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è"></textarea>
                </div>
                
                <div class="form-group">
                    <label>–ö–æ–¥ (4 —Å–∏–º–≤–æ–ª–∞):</label>
                    <input type="text" id="taskCode" maxlength="4" placeholder="ABCD">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                        <select id="taskDifficulty">
                            <option value="easy">–õ–µ–≥–∫–æ–µ</option>
                            <option value="medium">–°—Ä–µ–¥–Ω–µ–µ</option>
                            <option value="hard">–°–ª–æ–∂–Ω–æ–µ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–û—á–∫–∏:</label>
                        <input type="number" id="taskPoints" value="10">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</label>
                    <textarea id="taskHint" rows="2" placeholder="–ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è"></textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="addTask()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                    <button class="btn btn-danger" onclick="closeTaskForm()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
            
            <div class="task-form" id="editTaskForm">
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <select id="editTaskSelect" onchange="loadTaskData()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–í–æ–ø—Ä–æ—Å:</label>
                    <textarea id="editTaskQuestion" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>–ö–æ–¥ (4 —Å–∏–º–≤–æ–ª–∞):</label>
                    <input type="text" id="editTaskCode" maxlength="4">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                        <select id="editTaskDifficulty">
                            <option value="easy">–õ–µ–≥–∫–æ–µ</option>
                            <option value="medium">–°—Ä–µ–¥–Ω–µ–µ</option>
                            <option value="hard">–°–ª–æ–∂–Ω–æ–µ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–û—á–∫–∏:</label>
                        <input type="number" id="editTaskPoints">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</label>
                    <textarea id="editTaskHint" rows="2"></textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-warning" onclick="updateTask()">‚úèÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn btn-danger" onclick="closeTaskForm()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div class="modal" id="qrModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì± QR-–∫–æ–¥ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–≥—Ä–µ</h3>
                <button class="close" onclick="closeQRModal()">&times;</button>
            </div>
            <div style="text-align: center;">
                <img id="qrImage" style="max-width: 100%; border-radius: 10px;">
                <p style="margin-top: 15px; color: #666;">
                    –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–≥—Ä–µ
                </p>
                <div class="btn-group" style="justify-content: center;">
                    <button class="btn btn-success" onclick="downloadQRCode()">üíæ –°–∫–∞—á–∞—Ç—å</button>
                    <button class="btn btn-primary" onclick="copyGameLink()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let adminAccess = false;
        let firebaseApp = null;
        let firebaseDB = null;
        let gameTasks = [];
        let resultsInterval = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            checkExistingAccess();
        };

        // üìù –§–£–ù–ö–¶–ò–ò –î–û–°–¢–£–ü–ê
        function checkAccess() {
            const code = document.getElementById('accessCode').value;
            const currentPassword = localStorage.getItem('admin_password') || GAME_ACCESS_CODE;
            
            if (code === currentPassword) {
                localStorage.setItem('admin_access', 'true');
                document.getElementById('accessScreen').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                initFirebase();
                loadResults();
                showNotification('‚úÖ –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω!', 'success');
            } else {
                document.getElementById('accessError').style.display = 'block';
                document.getElementById('accessError').textContent = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞!';
                showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞!', 'error');
            }
        }

        function checkExistingAccess() {
            if (localStorage.getItem('admin_access') === 'true') {
                document.getElementById('accessScreen').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                adminAccess = true;
                initFirebase();
                loadResults();
            }
        }

        // üîë –°–ú–ï–ù–ê –ü–ê–†–û–õ–Ø
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const storedPassword = localStorage.getItem('admin_password') || GAME_ACCESS_CODE;

            if (currentPassword !== storedPassword) {
                showNotification('‚ùå –¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π!', 'error');
                return;
            }

            if (newPassword.length < 4) {
                showNotification('‚ùå –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞!', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showNotification('‚ùå –ù–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!', 'error');
                return;
            }

            localStorage.setItem('admin_password', newPassword);
            showNotification('‚úÖ –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!', 'success');
            
            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        // üîÑ –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–ê–ë–ê–ú–ò
        function switchTab(tabName) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ç–∞–±—É
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            if (tabName === 'results') {
                loadResults();
            }
        }

        // üî• FIREBASE –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        function initFirebase() {
            try {
                if (typeof window.FIREBASE_CONFIG !== 'undefined') {
                    firebase.initializeApp(window.FIREBASE_CONFIG);
                    firebaseApp = firebase;
                    firebaseDB = firebase.database();
                    console.log('Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                    showNotification('‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω!', 'success');
                } else {
                    console.error('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase', 'error');
            }
        }

        // üìã –ò–ì–†–û–í–´–ï –§–£–ù–ö–¶–ò–ò
        function generateGameLink() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –∏–≥—Ä—É
                const gameUrl = 'https://fancifulaction-rgb.github.io/christmas_game/index.html?access=' + (localStorage.getItem('admin_password') || GAME_ACCESS_CODE);
                
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(gameUrl).then(() => {
                        showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                    }).catch(() => {
                        showManualCopy(gameUrl);
                    });
                } else {
                    showManualCopy(gameUrl);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏', 'error');
            }
        }

        function showManualCopy(text) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üìã –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É</h3>
                        <button class="close" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div style="padding: 20px;">
                        <textarea style="width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">${text}</textarea>
                        <p style="margin-top: 10px; color: #666;">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∏–≥—Ä–æ–∫–∞–º</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function copyGameLink() {
            generateGameLink();
            closeQRModal();
        }

        function downloadQRCode() {
            try {
                const gameUrl = 'https://fancifulaction-rgb.github.io/christmas_game/index.html?access=' + (localStorage.getItem('admin_password') || GAME_ACCESS_CODE);
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(gameUrl)}`;
                
                const link = document.createElement('a');
                link.href = qrCodeUrl;
                link.download = 'qr-code-game.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('‚úÖ QR-–∫–æ–¥ —Å–∫–∞—á–∞–Ω!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è QR-–∫–æ–¥–∞:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è QR-–∫–æ–¥–∞', 'error');
            }
        }

        function showQRModal() {
            try {
                const gameUrl = 'https://fancifulaction-rgb.github.io/christmas_game/index.html?access=' + (localStorage.getItem('admin_password') || GAME_ACCESS_CODE);
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(gameUrl)}`;
                
                document.getElementById('qrImage').src = qrCodeUrl;
                document.getElementById('qrModal').classList.add('show');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞', 'error');
            }
        }

        function closeQRModal() {
            document.getElementById('qrModal').classList.remove('show');
        }

        function printInstructions() {
            const gameUrl = 'https://fancifulaction-rgb.github.io/christmas_game/index.html';
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(gameUrl)}`;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ù–æ–≤–æ–≥–æ–¥–Ω–µ–π –ò–≥—Ä—ã</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .qr-code { text-align: center; margin: 20px 0; }
                        .instructions { margin: 20px 0; line-height: 1.6; }
                    </style>
                </head>
                <body>
                    <h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –û—Ö–æ—Ç–∞ –∑–∞ –°–æ–∫—Ä–æ–≤–∏—â–∞–º–∏</h1>
                    <div class="qr-code">
                        <img src="${qrCodeUrl}" alt="QR Code">
                        <p>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∏–≥—Ä—É</p>
                    </div>
                    <div class="instructions">
                        <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤:</h2>
                        <ol>
                            <li>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ</li>
                            <li>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è</li>
                            <li>–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–æ–º–∞–Ω–¥—ã</li>
                            <li>–û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –≤–≤–æ–¥—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–¥—ã</li>
                            <li>–ü–æ–ª—É—á–∞–π—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</li>
                            <li>–ó–∞–≤–µ—Ä—à–∏—Ç–µ –∏–≥—Ä—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</li>
                        </ol>
                        <p><strong>–£–¥–∞—á–∏ –≤ –ø–æ–∏—Å–∫–µ —Å–æ–∫—Ä–æ–≤–∏—â! üéØ</strong></p>
                    </div>
                    <script>window.print(); setTimeout(() => window.close(), 1000);</script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        function openGame() {
            const gameUrl = 'https://fancifulaction-rgb.github.io/christmas_game/index.html?access=' + (localStorage.getItem('admin_password') || GAME_ACCESS_CODE);
            window.open(gameUrl, '_blank');
        }

        // üìù –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø–ú–ò
        function showTaskForm(action) {
            if (action === 'add') {
                document.getElementById('taskModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ';
                document.getElementById('addTaskForm').classList.add('show');
                document.getElementById('editTaskForm').classList.remove('show');
            } else if (action === 'edit') {
                document.getElementById('taskModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ';
                document.getElementById('addTaskForm').classList.remove('show');
                document.getElementById('editTaskForm').classList.add('show');
                loadTaskListForEdit();
            }
            document.getElementById('taskModal').classList.add('show');
        }

        function closeTaskForm() {
            document.getElementById('taskModal').classList.remove('show');
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('addTaskForm').reset();
            document.getElementById('editTaskForm').reset();
            document.getElementById('addTaskForm').classList.remove('show');
            document.getElementById('editTaskForm').classList.remove('show');
        }

        function addTask() {
            const question = document.getElementById('taskQuestion').value.trim();
            const code = document.getElementById('taskCode').value.trim().toUpperCase();
            const difficulty = document.getElementById('taskDifficulty').value;
            const points = parseInt(document.getElementById('taskPoints').value);
            const hint = document.getElementById('taskHint').value.trim();

            if (!question || !code || code.length !== 4) {
                showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è! –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 4 —Å–∏–º–≤–æ–ª–∞.', 'error');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–¥–∞
            const existingTask = gameTasks.find(task => task.code === code);
            if (existingTask) {
                showNotification('‚ùå –ó–∞–¥–∞–Ω–∏–µ —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'error');
                return;
            }

            const newTask = {
                id: 'task_' + Date.now(),
                question: question,
                code: code,
                difficulty: difficulty,
                points: points,
                hint: hint
            };

            gameTasks.push(newTask);
            
            // –ï—Å–ª–∏ GitHub –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ–º
            const githubConfig = getGitHubConfig();
            if (githubConfig.token) {
                saveTasksToGitHub(githubConfig);
            }

            showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!', 'success');
            closeTaskForm();
            loadTasks(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        }

        function loadTaskListForEdit() {
            const select = document.getElementById('editTaskSelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ...</option>';
            
            gameTasks.forEach((task, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${task.code} - ${task.question.substring(0, 50)}...`;
                select.appendChild(option);
            });
        }

        function loadTaskData() {
            const select = document.getElementById('editTaskSelect');
            const index = select.value;
            
            if (index === '') return;
            
            const task = gameTasks[index];
            document.getElementById('editTaskQuestion').value = task.question;
            document.getElementById('editTaskCode').value = task.code;
            document.getElementById('editTaskDifficulty').value = task.difficulty;
            document.getElementById('editTaskPoints').value = task.points;
            document.getElementById('editTaskHint').value = task.hint || '';
        }

        function updateTask() {
            const select = document.getElementById('editTaskSelect');
            const index = select.value;
            
            if (index === '') {
                showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!', 'error');
                return;
            }

            const question = document.getElementById('editTaskQuestion').value.trim();
            const code = document.getElementById('editTaskCode').value.trim().toUpperCase();
            const difficulty = document.getElementById('editTaskDifficulty').value;
            const points = parseInt(document.getElementById('editTaskPoints').value);
            const hint = document.getElementById('editTaskHint').value.trim();

            if (!question || !code || code.length !== 4) {
                showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è! –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 4 —Å–∏–º–≤–æ–ª–∞.', 'error');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–¥–∞ (–∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ)
            const existingTask = gameTasks.find((task, i) => task.code === code && i !== parseInt(index));
            if (existingTask) {
                showNotification('‚ùå –ó–∞–¥–∞–Ω–∏–µ —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'error');
                return;
            }

            gameTasks[index] = {
                id: gameTasks[index].id,
                question: question,
                code: code,
                difficulty: difficulty,
                points: points,
                hint: hint
            };

            // –ï—Å–ª–∏ GitHub –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ–º
            const githubConfig = getGitHubConfig();
            if (githubConfig.token) {
                saveTasksToGitHub(githubConfig);
            }

            showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
            closeTaskForm();
            loadTasks(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        }

        function deleteTask() {
            if (gameTasks.length === 0) {
                showNotification('‚ùå –ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!', 'error');
                return;
            }

            const select = prompt(`–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (1-${gameTasks.length}):`);
            const index = parseInt(select) - 1;

            if (isNaN(index) || index < 0 || index >= gameTasks.length) {
                showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è!', 'error');
                return;
            }

            const task = gameTasks[index];
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ "${task.code}"?`)) {
                gameTasks.splice(index, 1);
                
                // –ï—Å–ª–∏ GitHub –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ–º
                const githubConfig = getGitHubConfig();
                if (githubConfig.token) {
                    saveTasksToGitHub(githubConfig);
                }

                showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                loadTasks(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            }
        }

        function loadTasks() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –∏–∑ GitHub
            const githubConfig = getGitHubConfig();
            
            if (githubConfig.token) {
                loadTasksFromGitHub(githubConfig);
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                loadLocalTasks();
            }
        }

        function loadLocalTasks() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                const storedTasks = localStorage.getItem('game_tasks');
                if (storedTasks) {
                    gameTasks = JSON.parse(storedTasks);
                } else {
                    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    gameTasks = [
                        {
                            id: 'task_1',
                            question: '–ì–¥–µ —Å–ø—Ä—è—Ç–∞–Ω –ø–µ—Ä–≤—ã–π –ø–æ–¥–∞—Ä–æ–∫?',
                            code: 'GIFT',
                            difficulty: 'easy',
                            points: 10,
                            hint: '–ò—â–∏—Ç–µ —Ä—è–¥–æ–º —Å —ë–ª–∫–æ–π'
                        },
                        {
                            id: 'task_2',
                            question: '–ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å–∫—É',
                            code: 'NOTE',
                            difficulty: 'medium',
                            points: 20,
                            hint: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—Ä–º–∞–Ω—ã –∫—É—Ä—Ç–æ–∫'
                        },
                        {
                            id: 'task_3',
                            question: '–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–æ–∫—Ä–æ–≤–∏—â–µ?',
                            code: 'FIND',
                            difficulty: 'hard',
                            points: 30,
                            hint: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–¥ –∫–æ–≤—Ä–∏–∫–æ–º'
                        }
                    ];
                }
                
                updateTaskList();
                showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π', 'error');
            }
        }

        function updateTaskList() {
            const taskList = document.getElementById('taskList');
            
            if (gameTasks.length === 0) {
                taskList.innerHTML = '<p>–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π</p>';
                return;
            }

            let html = '<div class="table-container"><table><thead><tr><th>–ö–æ–¥</th><th>–í–æ–ø—Ä–æ—Å</th><th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th><th>–û—á–∫–∏</th></tr></thead><tbody>';
            
            gameTasks.forEach((task, index) => {
                const difficultyClass = task.difficulty === 'easy' ? 'success' : 
                                      task.difficulty === 'medium' ? 'warning' : 'danger';
                html += `
                    <tr>
                        <td><strong>${task.code}</strong></td>
                        <td>${task.question.substring(0, 50)}...</td>
                        <td><span class="btn btn-${difficultyClass}" style="padding: 4px 8px; font-size: 12px;">${task.difficulty}</span></td>
                        <td>${task.points}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            taskList.innerHTML = html;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('game_tasks', JSON.stringify(gameTasks));
        }

        // üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–ó FIREBASE
        function loadResults() {
            if (!firebaseDB) {
                showNotification('‚ùå Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω', 'error');
                return;
            }

            try {
                firebaseDB.ref('games').once('value')
                    .then(snapshot => {
                        const results = snapshot.val() || {};
                        updateLeaderboard(results);
                        showNotification('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                        showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
                    });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤', 'error');
            }
        }

        function updateLeaderboard(results) {
            const resultsArray = Object.values(results);
            
            if (resultsArray.length === 0) {
                document.getElementById('resultsBody').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px; color: #666;">
                            üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä
                        </td>
                    </tr>
                `;
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É (–≤—Ä–µ–º—è + –æ—á–∫–∏)
            const sortedResults = resultsArray.sort((a, b) => {
                const aRating = (a.totalScore || 0) * 100 - (a.gameDuration || 0);
                const bRating = (b.totalScore || 0) * 100 - (b.gameDuration || 0);
                return bRating - aRating;
            });

            let html = '';

            sortedResults.forEach((result, index) => {
                const gameTime = result.gameDuration || 0;
                const minutes = Math.floor(gameTime / 60);
                const seconds = gameTime % 60;
                const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                const date = new Date(result.endTime || Date.now()).toLocaleDateString('ru-RU');
                
                html += `
                    <tr>
                        <td><strong>${result.playerName || '–ò–≥—Ä–æ–∫ ' + (index + 1)}</strong></td>
                        <td>${timeString}</td>
                        <td>${result.completedTasks ? result.completedTasks.length : 0}</td>
                        <td>${result.totalScore || 0}</td>
                        <td>${result.hintsUsed || 0}</td>
                        <td><strong>${((result.totalScore || 0) * 100 - (result.gameDuration || 0))}</strong></td>
                        <td>${date}</td>
                    </tr>
                `;
            });

            document.getElementById('resultsBody').innerHTML = html;
        }

        // üîó GITHUB –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø
        function getGitHubConfig() {
            const owner = document.getElementById('githubOwner').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            
            return { owner, repo, token };
        }

        function setupGitHubIntegration() {
            const config = getGitHubConfig();
            
            if (!config.owner || !config.repo || !config.token) {
                showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è GitHub –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏!', 'error');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('github_config', JSON.stringify(config));
            showNotification('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
        }

        function testGitHubConnection() {
            const config = getGitHubConfig();
            
            if (!config.token) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ Personal Access Token!', 'error');
                return;
            }

            const url = `https://api.github.com/repos/${config.owner}/${config.repo}`;
            
            fetch(url, {
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => {
                if (response.ok) {
                    showNotification('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GitHub —É—Å–ø–µ—à–Ω–æ!', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ GitHub:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
            });
        }

        function saveTasksToGitHub(config) {
            const gameData = {
                version: "5.3.5",
                gameTitle: "–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –û—Ö–æ—Ç–∞ –∑–∞ –°–æ–∫—Ä–æ–≤–∏—â–∞–º–∏",
                lastUpdated: new Date().toISOString(),
                tasks: gameTasks
            };

            const content = btoa(unescape(encodeURIComponent(JSON.stringify(gameData, null, 2))));
            const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/game-data.json`;

            fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å',
                    content: content
                })
            })
            .then(response => {
                if (response.ok) {
                    showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ GitHub!', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ GitHub:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
            });
        }

        function autoSaveToGitHub() {
            const config = getGitHubConfig();
            
            if (!config.token) {
                showNotification('‚ùå –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å–Ω–∞—á–∞–ª–∞!', 'error');
                return;
            }

            if (gameTasks.length === 0) {
                showNotification('‚ùå –ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
                return;
            }

            saveTasksToGitHub(config);
        }

        function loadTasksFromGitHub(config) {
            const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/game-data.json`;

            fetch(url, {
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .then(data => {
                const decoded = decodeURIComponent(escape(atob(data.content)));
                const gameData = JSON.parse(decoded);
                gameTasks = gameData.tasks || [];
                updateTaskList();
                showNotification('‚úÖ –ó–∞–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub!', 'success');
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ GitHub:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ GitHub: ' + error.message, 'error');
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ fallback
                loadLocalTasks();
            });
        }

        // üîß –°–ò–°–¢–ï–ú–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function checkSystem() {
            const systemInfo = document.getElementById('systemInfo');
            
            let info = '<div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">';
            info += '<h4>üîç –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:</h4>';
            info += '<ul style="list-style: none; padding: 0;">';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Firebase
            if (firebaseDB) {
                info += '<li style="color: green;">‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω</li>';
            } else {
                info += '<li style="color: red;">‚ùå Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</li>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ GitHub
            const githubConfig = JSON.parse(localStorage.getItem('github_config') || '{}');
            if (githubConfig.token) {
                info += '<li style="color: green;">‚úÖ GitHub –Ω–∞—Å—Ç—Ä–æ–µ–Ω</li>';
            } else {
                info += '<li style="color: orange;">‚ö†Ô∏è GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</li>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π
            info += `<li style="color: ${gameTasks.length > 0 ? 'green' : 'orange'};">üìù –ó–∞–¥–∞–Ω–∏–π: ${gameTasks.length}</li>`;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
            const storedPassword = localStorage.getItem('admin_password');
            if (storedPassword && storedPassword !== GAME_ACCESS_CODE) {
                info += '<li style="color: green;">üîë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–∞—Ä–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</li>';
            } else {
                info += '<li style="color: orange;">‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ä–æ–ª—å</li>';
            }
            
            info += '</ul></div>';
            systemInfo.innerHTML = info;
            
            showNotification('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'info');
        }

        // üîî –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.onload = function() {
            checkExistingAccess();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º GitHub –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const githubConfig = JSON.parse(localStorage.getItem('github_config') || '{}');
            if (githubConfig.owner) document.getElementById('githubOwner').value = githubConfig.owner;
            if (githubConfig.repo) document.getElementById('githubRepo').value = githubConfig.repo;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
            loadTasks();
        };
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –ò–≥—Ä–∞ v4.0</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã -->
    <script src="firebase-config.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-color: #dc3545;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #17a2b8;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffc107;
        }

        .task-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
        }

        .task-item.completed {
            border-color: #28a745;
            background: #d4edda;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        .task-number {
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .stat-card .label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: bold;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .leaderboard-table th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        .leaderboard-table tr:hover {
            background: #f5f5f5;
        }

        .qr-section {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 20px 0;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border: 3px solid #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            font-size: 12px;
            color: #666;
        }

        .config-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-connected {
            background: #d4edda;
            color: #155724;
        }

        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÑ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ù–æ–≤–æ–≥–æ–¥–Ω–µ–π –ò–≥—Ä—ã</h1>
            <p>–í–µ—Ä—Å–∏—è 4.0 - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Firebase</p>
            <p id="configStatus" class="config-status status-disconnected">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</p>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <div id="connectionAlert" class="alert alert-warning">
            <strong>üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã:</strong><br>
            –î–ª—è —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Firebase. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ —Ñ–∞–π–ª–µ <code>firebase-config.js</code>.
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="section">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="label">üèÜ –í—Å–µ–≥–æ –∫–æ–º–∞–Ω–¥</div>
                    <div class="value" id="totalTeams">0</div>
                </div>
                <div class="stat-card">
                    <div class="label">üìã –ê–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä</div>
                    <div class="value" id="activeGames">0</div>
                </div>
                <div class="stat-card">
                    <div class="label">‚≠ê –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
                    <div class="value" id="bestScore">0</div>
                </div>
                <div class="stat-card">
                    <div class="label">üéØ –í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π</div>
                    <div class="value" id="totalTasks">5</div>
                </div>
            </div>
        </div>

        <!-- QR-–∫–æ–¥ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤ -->
        <div class="section">
            <h2>üì± QR-–∫–æ–¥ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤</h2>
            <div class="qr-section">
                <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–æ–π —Å—Å—ã–ª–∫–æ–π —Å –∏–≥—Ä–æ–∫–∞–º–∏:</p>
                <div class="qr-code" id="qrCode">
                    <div>
                        <strong>QR-–∫–æ–¥</strong><br>
                        –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ QR<br>
                        –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∏–∂–µ
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <input type="text" id="gameUrl" readonly style="width: 100%; margin-bottom: 10px;" 
                           placeholder="URL –∏–≥—Ä—ã –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Firebase">
                    <button class="btn" onclick="copyGameUrl()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                    <button class="btn btn-info" onclick="generateQR()">üì∑ –°–æ–∑–¥–∞—Ç—å QR-–∫–æ–¥</button>
                </div>
            </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏ -->
        <div class="section">
            <h2>üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏</h2>
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>
                –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø—è—Ç –≤ —Å–∏–ª—É –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤. –ù–æ–º–µ—Ä–∞ –∑–∞–¥–∞–Ω–∏–π –Ω–µ –º–µ–Ω—è—Ç—å!
            </div>
            
            <div id="tasksContainer">
                <!-- –ó–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div style="margin-top: 20px;">
                <button class="btn btn-success" onclick="saveAllTasks()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <button class="btn btn-info" onclick="loadTasksFromFile()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞</button>
                <button class="btn" onclick="addNewTask()" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); float: right;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
            </div>
            <div style="clear: both; margin-top: 10px;"></div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–∞–Ω–¥ -->
        <div class="section">
            <h2>üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–∞–Ω–¥</h2>
            <div class="alert alert-info" id="resultsStatus" style="display: none;">
                –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...
            </div>
            
            <div id="leaderboardContainer">
                <table class="leaderboard-table" id="leaderboardTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>–ö–æ–º–∞–Ω–¥–∞</th>
                            <th>–ö–∞–ø–∏—Ç–∞–Ω</th>
                            <th>–û—á–∫–∏</th>
                            <th>–ó–∞–¥–∞–Ω–∏—è</th>
                            <th>–í—Ä–µ–º—è</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                    </tbody>
                </table>
            </div>
            
            <button class="btn btn-info" onclick="refreshLeaderboard()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥</button>
            <button class="btn btn-danger" onclick="clearAllResults()" style="float: right;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>

        <!-- –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ -->
        <div class="section">
            <h2>üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h2>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <a href="index.html" class="btn" target="_blank">üéÆ –û—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä—É</a>
                <a href="firebase-config.js" class="btn" target="_blank">‚öôÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Firebase</a>
                <button class="btn btn-info" onclick="testConnection()">üîå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </div>
        </div>
    </div>

    <script>
        // üî• –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        let firebaseApp = null;
        let firebaseDB = null;
        let firebaseConnected = false;
        let currentTasks = [];

        // üìä –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        async function initializeAdmin() {
            console.log('üîß –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É Firebase
            if (!window.FIREBASE_CONFIG || !window.FIREBASE_CONFIG.enabled) {
                updateConnectionStatus(false, 'Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
                return;
            }
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
                firebaseApp = firebase.initializeApp(window.FIREBASE_CONFIG);
                firebaseDB = firebase.database();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                await firebaseDB.ref('.info/connected').once('value');
                
                firebaseConnected = true;
                updateConnectionStatus(true, 'Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω');
                
                console.log('‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≥–æ—Ç–æ–≤–∞');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadTasksFromCloud();
                await loadLeaderboard();
                await updateStats();
                await setupGameUrl();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                updateConnectionStatus(false, '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
            }
        }

        // üîå –°–¢–ê–¢–£–° –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø
        function updateConnectionStatus(connected, message) {
            const statusEl = document.getElementById('configStatus');
            const alertEl = document.getElementById('connectionAlert');
            
            if (connected) {
                statusEl.textContent = '‚úÖ ' + message;
                statusEl.className = 'config-status status-connected';
                alertEl.className = 'alert alert-success';
                alertEl.innerHTML = '<strong>‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞!</strong><br>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.';
            } else {
                statusEl.textContent = '‚ùå ' + message;
                statusEl.className = 'config-status status-disconnected';
                alertEl.className = 'alert alert-warning';
                alertEl.innerHTML = '<strong>‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!</strong><br>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Firebase –≤ —Ñ–∞–π–ª–µ <code>firebase-config.js</code> –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã.';
            }
        }

        // üìã –ó–ê–ì–†–£–ó–ö–ê –ó–ê–î–ê–ù–ò–ô –ò–ó –û–ë–õ–ê–ö–ê
        async function loadTasksFromCloud() {
            try {
                const configSnapshot = await firebaseDB.ref('gameConfig/config').once('value');
                const config = configSnapshot.val();
                
                if (config && config.tasks) {
                    currentTasks = config.tasks;
                    renderTasks();
                    console.log('‚úÖ –ó–∞–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –æ–±–ª–∞–∫–∞');
                } else {
                    await loadTasksFromFile();
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π –∏–∑ –æ–±–ª–∞–∫–∞:', error);
                await loadTasksFromFile();
            }
        }

        // üìÅ –ó–ê–ì–†–£–ó–ö–ê –ó–ê–î–ê–ù–ò–ô –ò–ó –§–ê–ô–õ–ê
        async function loadTasksFromFile() {
            try {
                const response = await fetch('game-data.json');
                const data = await response.json();
                currentTasks = data.tasks || [];
                renderTasks();
                console.log('‚úÖ –ó–∞–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞–Ω–∏–π –∏–∑ —Ñ–∞–π–ª–∞', 'error');
            }
        }

        // üé® –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ó–ê–î–ê–ù–ò–ô
        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            let html = '';
            
            currentTasks.forEach((task, index) => {
                // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                const title = (task.title || '–ó–∞–¥–∞–Ω–∏–µ ' + (index + 1)).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                const description = (task.description || '').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                const code = (task.code || '').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                const hint = (task.hint || '').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                
                html += `
                    <div class="task-item">
                        <div class="task-header">
                            <div class="task-number">${index + 1}</div>
                            <div class="task-title">${title}</div>
                            <div class="task-actions">
                                <button class="btn" onclick="editTask(${index})">‚úèÔ∏è</button>
                                <button class="btn btn-danger" onclick="deleteTask(${index})">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                            <input type="text" id="taskTitle_${index}" value="${task.title || ''}" 
                                   onchange="updateTask(${index}, 'title', this.value)">
                        </div>
                        <div class="form-group">
                            <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                            <textarea id="taskDescription_${index}" onchange="updateTask(${index}, 'description', this.value)">${task.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–¥ (–∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏):</label>
                            <input type="text" id="taskCode_${index}" value="${code}" 
                                   style="text-transform: uppercase;" onchange="updateTask(${index}, 'code', this.value.toUpperCase())">
                        </div>
                        <div class="form-group">
                            <label>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</label>
                            <input type="text" id="taskHint_${index}" value="${hint}" 
                                   onchange="updateTask(${index}, 'hint', this.value)">
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ‚úèÔ∏è –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø
        function editTask(index) {
            const task = currentTasks[index];
            const newTitle = prompt('–ò–∑–º–µ–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–¥–∞–Ω–∏—è:', task.title);
            if (newTitle !== null) {
                currentTasks[index].title = newTitle;
                renderTasks();
            }
        }

        // üóëÔ∏è –£–î–ê–õ–ï–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø
        function deleteTask(index) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ "${currentTasks[index].title}"?`)) {
                currentTasks.splice(index, 1);
                renderTasks();
            }
        }

        // üîÑ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø
        function updateTask(index, field, value) {
            if (currentTasks[index]) {
                currentTasks[index][field] = value;
            }
        }

        // ‚ûï –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–û–ï –ó–ê–î–ê–ù–ò–ï
        function addNewTask() {
            const newTask = {
                id: currentTasks.length + 1,
                title: `–ù–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ ${currentTasks.length + 1}`,
                description: '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è',
                code: 'CODE' + (currentTasks.length + 1),
                hint: '–ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è'
            };
            currentTasks.push(newTask);
            renderTasks();
        }

        // üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï –í –û–ë–õ–ê–ö–û
        async function saveAllTasks() {
            if (!firebaseConnected) {
                showAlert('‚ùå Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω!', 'error');
                return;
            }
            
            try {
                showAlert('üîÑ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ...', 'info');
                
                const config = {
                    version: '4.0.0',
                    timestamp: Date.now(),
                    tasks: currentTasks
                };
                
                await firebaseDB.ref('gameConfig/config').set(config);
                
                showAlert('‚úÖ –ó–∞–¥–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ–±–ª–∞–∫–æ!', 'success');
                console.log('‚úÖ –ó–∞–¥–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê
        async function updateStats() {
            if (!firebaseConnected) return;
            
            try {
                const teamsSnapshot = await firebaseDB.ref('teams').once('value');
                const teams = teamsSnapshot.val() || {};
                const teamsList = Object.values(teams);
                
                document.getElementById('totalTeams').textContent = teamsList.length;
                document.getElementById('activeGames').textContent = teamsList.filter(t => !t.completed).length;
                
                // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                const bestScore = teamsList.length > 0 ? Math.max(...teamsList.map(t => t.score || 0)) : 0;
                document.getElementById('bestScore').textContent = bestScore;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // üèÜ –†–ï–ô–¢–ò–ù–ì –ö–û–ú–ê–ù–î
        async function loadLeaderboard() {
            if (!firebaseConnected) {
                document.getElementById('leaderboardTable').style.display = 'none';
                return;
            }
            
            const statusEl = document.getElementById('resultsStatus');
            statusEl.style.display = 'block';
            statusEl.textContent = 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...';
            
            try {
                const teamsSnapshot = await firebaseDB.ref('teams').orderByChild('score').once('value');
                const teams = teamsSnapshot.val() || {};
                
                const teamsList = Object.values(teams).sort((a, b) => (b.score || 0) - (a.score || 0));
                
                const tbody = document.getElementById('leaderboardBody');
                tbody.innerHTML = '';
                
                teamsList.forEach((team, index) => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td><strong>${team.teamName}</strong></td>
                        <td>${team.captainName}</td>
                        <td><strong>${team.score || 0}</strong></td>
                        <td>${team.currentTask || 0}/5</td>
                        <td>${formatTime(team.totalTime || 0)}</td>
                        <td>${team.completed ? '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ' : 'üéÆ –í –ø—Ä–æ—Ü–µ—Å—Å–µ'}</td>
                    `;
                });
                
                statusEl.style.display = 'none';
                document.getElementById('leaderboardTable').style.display = 'table';
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:', error);
                statusEl.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
            }
        }

        // ‚è±Ô∏è –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –í–†–ï–ú–ï–ù–ò
        function formatTime(seconds) {
            if (!seconds) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // üîÑ –û–ë–ù–û–í–õ–ï–ù–ò–ï –†–ï–ô–¢–ò–ù–ì–ê
        async function refreshLeaderboard() {
            await loadLeaderboard();
            await updateStats();
        }

        // üóëÔ∏è –û–ß–ò–°–¢–ö–ê –í–°–ï–• –†–ï–ó–£–õ–¨–¢–ê–¢–û–í
        async function clearAllResults() {
            if (!confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–∞–Ω–¥?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
                return;
            }
            
            if (!confirm('üö® –ü–û–°–õ–ï–î–ù–ï–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï!\n\n–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?')) {
                return;
            }
            
            try {
                await firebaseDB.ref('teams').remove();
                showAlert('‚úÖ –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–¥–∞–ª–µ–Ω—ã!', 'success');
                await refreshLeaderboard();
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // üîå –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø
        async function testConnection() {
            if (!window.FIREBASE_CONFIG || !window.FIREBASE_CONFIG.enabled) {
                showAlert('‚ùå Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ firebase-config.js', 'error');
                return;
            }
            
            try {
                showAlert('üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...', 'info');
                
                // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
                await firebaseDB.ref('test').set({
                    message: 'Test message',
                    timestamp: Date.now()
                });
                
                // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
                const snapshot = await firebaseDB.ref('test').once('value');
                
                // –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                await firebaseDB.ref('test').remove();
                
                showAlert('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!', 'success');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // üì± –ù–ê–°–¢–†–û–ô–ö–ê URL –î–õ–Ø –ò–ì–†–û–ö–û–í
        async function setupGameUrl() {
            const urlInput = document.getElementById('gameUrl');
            const gameUrl = window.location.origin + window.location.pathname.replace('admin.html', 'index.html');
            
            urlInput.value = gameUrl;
        }

        // üìã –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –°–°–´–õ–ö–ò
        function copyGameUrl() {
            const urlInput = document.getElementById('gameUrl');
            urlInput.select();
            document.execCommand('copy');
            showAlert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
        }

        // üì∑ –ì–ï–ù–ï–†–ê–¶–ò–Ø QR-–ö–û–î–ê
        function generateQR() {
            const url = document.getElementById('gameUrl').value;
            if (!url) {
                showAlert('‚ùå –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Firebase', 'error');
                return;
            }
            
            const qrCodeDiv = document.getElementById('qrCode');
            qrCodeDiv.innerHTML = `
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}" 
                     alt="QR-–∫–æ–¥" style="width: 100%; height: 100%; object-fit: contain;">
            `;
        }

        // üí¨ –ü–û–ö–ê–ó –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
        function showAlert(message, type) {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.minWidth = '300px';
            alertDiv.style.animation = 'slideIn 0.3s';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.animation = 'slideOut 0.3s';
                setTimeout(() => alertDiv.remove(), 300);
            }, 3000);
        }

        // üöÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
        document.addEventListener('DOMContentLoaded', initializeAdmin);

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>